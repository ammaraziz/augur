{
    "$schema": "http://json-schema.org/draft-06/schema#",
    "$id": "https://nextstrain.org/schemas/multiplot/v1",
    "title": "Nextstrain multiplot data schema proposal with collection at the top level",
    "type": "object",
    "additionalProperties": false,
    "required": ["collections"],
    "properties": {
        "default_collection": {
            "description": "Default collection to display where the value must be the `key` in one of the objects of the collections array. Optional -- if not provided, first collection will be displayed",
            "type": "string"
        },
        "collections": {
            "description": "Collections of measurements and their configurations for display in auspice",
            "type": "array",
            "minItems": 1,
            "items": {
                "description": "A single collection of related measurements and the collection's display config",
                "type": "object",
                "additionalProperties": false,
                "required": ["key", "config", "measurements"],
                "properties": {
                    "key": {
                        "description": "The short name of the collection that is only used internally within auspice. Each collection is expected to have a unique key.",
                        "type": "string"
                    },
                    "config": {
                        "description": "A collection's config for display text and display options",
                        "type": "object",
                        "additionalProperties": false,
                        "required": ["groupings", "x_axis_label"],
                        "properties": {
                            "title": {
                                "description": "The title to display in the collections dropdown and panel title. Optional -- if not provided, then `key` will be used",
                                "type": "string"
                            },
                            "groupings": {
                                "description": "The available group by options and their display titles",
                                "type": "array",
                                "minItems": 1,
                                "items": {
                                    "description": "A single group by option",
                                    "type": "object",
                                    "additionalProperties": false,
                                    "required": ["key"],
                                    "properties": {
                                        "key": {
                                            "description": "The property name of the group by option",
                                            "type": "string"
                                        },
                                        "title": {
                                            "description": "The title to display in the group by dropdown. Optional -- if not provided, then `key` will be used",
                                            "type": "string"
                                        }
                                    }
                                }
                            },
                            "x_axis_label": {
                                "description": "The short label to display for the x-axis that describes the `value` of the measurements in a collection",
                                "type": "string"
                            },
                            "description": {
                                "description": "A brief paragraph that describes the assay or experiment behind the measurements",
                                "type": "string"
                            },
                            "threshold": {
                                "description": "A numeric measurement threshold to be displayed as a single grey line shared across subplots. Optional -- if not provided, no threshold will be displayed",
                                "type": "number"
                            },
                            "display_defaults": {
                                "description": "Default display options of the collection",
                                "type": "object",
                                "additionalProperties": false,
                                "minProperty": 1,
                                "properties": {
                                    "group_by": {
                                        "description": "Default group by option where the value must be the `key` in one of the objects of the groupings array. Optional -- if not provided, first group by option will be used",
                                        "type": "string"
                                    },
                                    "show_threshold": {
                                        "description": "Should the threshold line be displayed by default? Ignored if no threshold has been provided for collection",
                                        "type": "boolean"
                                    }
                                }
                            }
                        }
                    },
                    "measurements": {
                        "description": "All measurements for a single collection",
                        "type": "array",
                        "minItems": 1,
                        "items": {
                            "description": "A single measurement for a sample and it's associated metadata. At least one of the metadata properties should be a group by option",
                            "type": "object",
                            "required": ["strain", "value"],
                            "minProperties": 3,
                            "properties": {
                                "strain": {
                                    "description": "The name of the sample that matches the name of the sample within the tree",
                                    "type": "string"
                                },
                                "value": {
                                    "description": "The numeric value of the measurement",
                                    "type": "number"
                                }
                            },
                            "patternProperties": {
                                "^.*$": {
                                    "description": "Metadata associated with the measurement. Only metadata properties included in the groupings config will be included in the group by dropdown, but all metadata properties will be available as a filter",
                                    "type": ["string", "number", "boolean"]
                                }
                            }
                        }
                    }
                }
            }
        }
    }
}
